# **常见问题：Agentic Design Patterns**

## 1. 什么是"agentic design pattern"？

Agentic design pattern 是构建智能自主系统（agent）时遇到的常见问题的可重用、高级解决方案。这些模式为设计 agent 行为提供了结构化框架，就像软件设计模式为传统编程所做的那样。它们帮助开发人员构建更健壮、可预测和有效的 AI agent。

## 2. 本指南的主要目标是什么？

本指南旨在提供设计和构建 Agentic 系统的实践、动手介绍。它超越了理论讨论，提供了开发人员可以用来以可靠的方式创建能够进行复杂、目标导向行为的 agent 的具体架构蓝图。

## 3. 本指南的目标受众是谁？

本指南是为使用大型语言模型（LLM）和其他 AI 组件构建应用程序的 AI 开发人员、软件工程师和系统架构师编写的。它适用于那些希望从简单的 prompt-response 交互转向创建复杂的自主 agent 的人。

## 4. 本指南讨论了哪些关键的 Agentic 模式？

根据目录，本指南涵盖了几个关键模式，包括：

- **Reflection（反思）**：Agent 批判自己的行动和输出以提高性能的能力。
- **Planning（规划）**：将复杂目标分解为较小的、可管理的步骤或任务的过程。
- **Tool Use（工具使用）**：Agent 利用外部工具（如代码解释器、搜索引擎或其他 API）获取信息或执行其自身无法执行的操作的模式。
- **Multi-Agent Collaboration（多 Agent 协作）**：让多个专业 agent 协作解决问题的架构，通常涉及"领导"或"编排器" agent。
- **Human-in-the-Loop（人在循环中）**：集成人类监督和干预，允许对 agent 的行动进行反馈、纠正和批准。

## 5. 为什么"规划"是一个重要的模式

规划至关重要，因为它允许 agent 处理无法通过单个操作解决的复杂的多步骤任务。通过创建计划，agent 可以维护连贯的策略、跟踪其进度，并以结构化的方式处理错误或意外障碍。这防止 agent 陷入困境或偏离用户的最终目标。

## 6. 对于 agent 来说，"工具"和"技能"有什么区别

虽然这些术语经常互换使用，但"工具"通常指的是 agent 可以调用的外部资源（例如，天气 API、计算器）。"技能"是 agent 已经学习的更集成的能力，通常结合工具使用和内部推理来执行特定功能（例如，"预订航班"的技能可能涉及使用日历和航空公司 API）。

## 7. "Reflection"模式如何提高 agent 的性能

Reflection 作为一种自我纠正的形式。在生成响应或完成任务后，可以提示 agent 审查其工作，检查错误，根据特定标准评估其质量，或考虑替代方法。这个迭代完善过程帮助 agent 产生更准确、相关和高质量的结果。

## 8. Reflection 模式的核心思想是什么

Reflection 模式使 agent 能够退后一步并批判自己的工作。而不是一次性产生最终输出，agent 生成草稿，然后"反思"它，识别缺陷、缺失信息或改进领域。这个自我纠正过程是提高其响应质量和准确性的关键。

## 9. 为什么简单的"prompt chaining"不足以产生高质量的输出？**

简单的 prompt chaining（其中一个 prompt 的输出成为下一个 prompt 的输入）通常太基础。模型可能只是重新表述其先前的输出，而没有真正改进它。真正的 Reflection 模式需要更结构化的批判，提示 agent 根据特定标准分析其工作，检查逻辑错误或验证事实。

## 10. 本章提到的两种主要反思类型是什么？**

本章讨论了两种主要形式的反思：

- **"检查你的工作"反思**：这是一种基本形式，其中 agent 被简单地要求审查和修复其先前的输出。这是捕获简单错误的一个良好起点。
- **"内部批判者"反思**：这是一种更高级的形式，其中使用单独的"批判者" agent（或专用 prompt）来评估"工作者" agent 的输出。可以给这个批判者特定的标准来查找，导致更严格和有针对性的改进。

## 11. 反思如何帮助减少"幻觉"？

通过提示 agent 审查其工作，特别是通过将其陈述与已知源进行比较或通过检查其自己的推理步骤，Reflection 模式可以显著降低幻觉（编造事实）的可能性。Agent 被迫更多地基于提供的上下文，不太可能生成不受支持的信息。

## 12. Reflection 模式可以应用多次吗？

是的，反思可以是一个迭代过程。可以让 agent 多次反思其工作，每次循环进一步完善输出。这对于复杂任务特别有用，其中第一次或第二次尝试可能仍包含细微错误或可以大幅改进。

## 13. 在 AI agent 的上下文中，Planning 模式是什么？

Planning 模式涉及使 agent 能够将复杂的、高级的目标分解为一系列较小的、可操作的步骤。而不是试图一次性解决一个大问题，agent 首先创建一个"计划"，然后执行计划中的每个步骤，这是一种更可靠的方法。

## 14. 为什么规划对于复杂任务是必要的？

LLM 可能在需要多个步骤或依赖项的任务上遇到困难。没有计划，agent 可能会失去对总体目标的跟踪，错过关键步骤，或者无法将一个步骤的输出作为下一个步骤的输入来处理。计划提供了清晰的路线图，确保原始请求的所有要求都以逻辑顺序得到满足。

## 15. 实现 Planning 模式的常见方法是什么？

常见的实现是让 agent 首先生成一个结构化格式的步骤列表（如 JSON 数组或编号列表）。然后，系统可以遍历此列表，逐个执行每个步骤，并将结果反馈给 agent 以通知下一个操作。

## 16. Agent 如何处理执行期间的错误或变化？

强大的规划模式允许动态调整。如果步骤失败或情况发生变化，可以提示 agent 从当前状态"重新规划"。它可以分析错误，修改剩余步骤，甚至添加新步骤以克服障碍。

## 17. 用户是否看到计划？

这是一个设计选择。在许多情况下，首先向用户显示计划以获得批准是一个很好的做法。这与"Human-in-the-Loop"模式保持一致，在执行之前给予用户透明度和对 agent 提议行动的控制。

## 18. "Tool Use"模式包含什么？

Tool Use 模式允许 agent 通过与外部软件或 API 交互来扩展其能力。由于 LLM 的知识是静态的，它无法自行执行真实世界的操作，工具使其能够访问实时信息（例如，Google Search）、专有数据（例如，公司的数据库）或执行操作的能力（例如，发送电子邮件、预订会议）。

## 19. Agent 如何决定使用哪个工具？

Agent 通常被提供一个可用工具列表，以及每个工具的功能和所需参数的描述。当面临无法用其内部知识处理的请求时，agent 的推理能力使其能够从列表中选择最合适的工具来完成任务。

## 20. 在这种情况下提到的"ReAct"（Reason and Act）框架是什么？

ReAct 是一个集成推理和行动的流行框架。Agent 遵循一个循环：**思考**（推理需要做什么）、**行动**（决定使用哪个工具以及使用什么输入）和**观察**（查看工具的结果）。此循环持续进行，直到它收集到足够的信息来满足用户的请求。

## 21. 实现工具使用有哪些挑战？

主要挑战包括：

- **错误处理**：工具可能失败、返回意外数据或超时。Agent 需要能够识别这些错误，并决定是否重试、使用不同的工具或向用户寻求帮助。
- **安全性**：给予 agent 访问工具，特别是执行操作的工具，具有安全影响。对于敏感操作，拥有安全措施、权限和通常的人类批准至关重要。
- **提示**：必须有效地提示 agent 以生成正确格式的工具调用（例如，正确的函数名称和参数）。

## 22. 什么是 Human-in-the-Loop (HITL) 模式？

HITL 是一种将人类监督和交互集成到 agent 工作流程中的模式。而不是完全自主，agent 在关键时刻暂停以请求人类反馈、批准、澄清或指导。

## 23. 为什么 HITL 对 Agentic 系统很重要？

这对于几个原因至关重要：

- **安全和控制**：对于高风险任务（例如，金融交易、发送官方通信），HITL 确保人类在 agent 提议的行动执行之前对其进行验证。
- **提高质量**：人类可以提供纠正或细致的反馈，agent 可以使用这些反馈来改善其性能，特别是在主观或模糊的任务中。
- **建立信任**：用户更可能信任和采用他们可以指导和监督的 AI 系统。

## 24. 在工作流程的哪些点应该包含人类？

人类干预的常见点包括：

- **计划批准**：在执行多步骤计划之前。
- **工具使用确认**：在使用具有真实世界后果或需要花钱的工具之前。
- **模糊性解决**：当 agent 不确定如何继续或需要来自用户的更多信息时。
- **最终输出审查**：在向最终用户或系统交付最终结果之前。

## 25. 持续的人类干预不是效率低下吗？

可能是的，这就是为什么关键是要找到正确的平衡。HITL 应该在关键检查点实施，而不是针对每个单独的操作。目标是建立人类和 agent 之间的协作伙伴关系，其中 agent 处理大部分工作，人类提供战略指导。

## 26. 什么是 Multi-Agent Collaboration 模式？

此模式涉及创建一个由多个专业 agent 组成的系统，这些 agent 协作以实现共同目标。而不是一个"通才" agent 试图做所有事情，您创建一个"专家" agent 团队，每个 agent 具有特定的角色或专业知识。

## 27. 多 agent 系统有哪些好处？

- **模块化和专业化**：每个 agent 可以针对其特定任务进行微调和提示（例如，"研究员" agent、"作家" agent、"代码" agent），从而产生更高质量的结果。
- **降低复杂性**：将复杂的工作流程分解为专业角色使整个系统更易于设计、调试和维护。
- **模拟头脑风暴**：不同的 agent 可以提供问题的不同视角，导致更有创意和健壮的解决方案，类似于人类团队的工作方式。

## 28. 多 agent 系统的常见架构是什么？

常见的架构涉及 **Orchestrator Agent**（有时称为"管理者"或"指挥者"）。编排器理解总体目标，将其分解，并将子任务委派给适当的专业 agent。然后，它从专家那里收集结果并将它们综合成最终输出。

## agent 如何相互通信？

通信通常由编排器管理。例如，编排器可能将"研究员" agent 的输出作为上下文传递给"作家" agent。一个共享的"便笺本"或消息总线，agent 可以在其中发布其发现，是另一种常见的通信方法。

## 为什么评估 agent 比评估传统软件程序更困难？

传统软件具有确定性输出（相同的输入总是产生相同的输出）。Agent，特别是那些使用 LLM 的 agent，是非确定性的，它们的性能可能是主观的。评估它们需要评估其输出的 *质量* 和 *相关性*，而不仅仅是它在技术上是否"正确"。

## 评估 agent 性能的一些常见方法是什么？

本指南建议几种方法：

- **基于结果的评估**：Agent 是否成功实现了最终目标？例如，如果任务是"预订航班"，航班是否实际被正确预订？这是最重要的衡量标准。
- **基于过程的评估**：Agent 的 *过程* 是否高效和合乎逻辑？它使用了正确的工具吗？它遵循了合理的计划吗？这有助于调试 agent 可能失败的原因。
- **人类评估**：让人类根据有用性、准确性和连贯性等标准对 agent 的性能进行评分（例如，1-5 分）。这对于面向用户的应用程序至关重要。

## 什么是"agent trajectory"？

Agent trajectory 是 agent 在执行任务时其步骤的完整日志。它包括其所有想法、行动（工具调用）和观察。分析这些轨迹是调试和理解 agent 行为的关键部分。

## 如何为非确定性系统创建可靠的测试？

虽然您无法保证 agent 输出的确切措辞，但您可以创建检查关键元素的测试。例如，您可以编写一个测试来验证 agent 的最终响应是否 *包含* 特定信息，或者它是否使用正确的参数成功调用了某个工具。这通常使用专用测试环境中的 mock 工具来完成。

## 提示 agent 与简单的 ChatGPT prompt 有何不同？

提示 agent 涉及创建详细的"system prompt"或章程，作为其操作指令。这超越了单个用户查询；它定义了 agent 的角色、其可用工具、它应该遵循的模式（如 ReAct 或 Planning）、其约束及其个性。

## agent 的良好 system prompt 的关键组件是什么？

强大的 system prompt 通常包括：

- **角色和目标**：明确定义 agent 是谁以及其主要目的是什么。
- **工具定义**：可用工具列表、它们的描述以及如何使用它们（例如，在特定的 function-calling 格式中）。
- **约束和规则**：关于 agent *不应该* 做什么的明确指令（例如，"未经批准不要使用工具"、"不要提供财务建议"）。
- **过程指令**：关于使用哪些模式的指导。例如，"首先，创建一个计划。然后，逐步执行计划。"
- **示例轨迹**：提供一些成功的"思考-行动-观察"循环的示例可以显著提高 agent 的可靠性。

## 什么是"prompt leakage"？

Prompt leakage 发生在 system prompt 的部分（如工具定义或内部指令）在 agent 对用户的最终响应中无意中泄露时。这可能使用户感到困惑，并暴露底层实现细节。使用单独的 prompt 进行推理和生成最终答案等技术可以帮助防止这种情况。

## Agentic 系统的一些未来趋势是什么？

本指南指向一个具有以下特征的未来：

- **更多自主 Agent**：需要较少人类干预并可以自主学习和适应的 agent。
- **高度专业化的 Agent**：可以雇用或订阅用于特定任务的 agent 生态系统（例如，旅行 agent、研究 agent）。
- **更好的工具和平台**：开发更复杂的框架和平台，使构建、测试和部署强大的多 agent 系统变得更加容易。
